var taskId = <%= @task.id %>;
var taskStatus = "<%= @task.completed? ? 'completed' : 'active' %>";
var csrfToken = document.querySelector('meta[name="csrf-token"]').getAttribute('content');
var checkbox = document.getElementById("complete_" + taskId);
var url = `/tasks/${taskId}`;
var previousStatus = taskStatus;

checkbox.checked = taskStatus === "completed";

if (checkbox) {
    checkbox.addEventListener('change', function(event) {
    const status = event.target.checked ? 'completed' : 'active';

    if (status !== previousStatus) { 
        previousStatus = status;
        console.log(url);

        fetch(url, {
            method: 'PATCH',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRF-Token': csrfToken,
            },
            body: JSON.stringify({ status: status }),
        })
        .then(response => response.json())
        .then(data => {
            console.log(data);
            checkbox.checked = data.status === 'completed';
        });
    }
});
}